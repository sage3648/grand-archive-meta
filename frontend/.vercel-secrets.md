# Vercel Secrets Configuration

This document explains how to set up Vercel secrets for use in `vercel.json`.

## What Are Vercel Secrets?

Vercel secrets are encrypted environment variables that can be referenced in `vercel.json` using the `@` prefix. They are stored securely in Vercel's infrastructure and shared across projects.

## Current Configuration

The `vercel.json` file references these secrets:

```json
{
  "env": {
    "NEXT_PUBLIC_API_URL": "@api_url",
    "NEXT_PUBLIC_SITE_URL": "@site_url"
  }
}
```

## Setting Up Secrets

### Option 1: Use Environment Variables Instead (Recommended)

Instead of using secrets, it's simpler to use environment variables directly in the Vercel dashboard:

1. Go to Project → Settings → Environment Variables
2. Add variables directly (no @ prefix needed)
3. Redeploy

**This is the recommended approach** and doesn't require the secrets setup below.

### Option 2: Using Vercel Secrets (Advanced)

If you prefer to use secrets, follow these steps:

#### 1. Install Vercel CLI

```bash
npm install -g vercel
vercel login
```

#### 2. Create Secrets

```bash
# Create API URL secret
vercel secrets add api_url "https://api.grandarchivemeta.com/api"

# Create Site URL secret
vercel secrets add site_url "https://grandarchivemeta.com"
```

#### 3. Verify Secrets

```bash
# List all secrets
vercel secrets ls
```

#### 4. Link Secrets to Project

Secrets are automatically available to all projects in your account. The `vercel.json` configuration will reference them automatically.

#### 5. Deploy

```bash
vercel --prod
```

## Managing Secrets

### Add New Secret

```bash
vercel secrets add <secret-name> "<secret-value>"

# Example
vercel secrets add ga_id "G-XXXXXXXXXX"
```

### Update Existing Secret

You must remove and re-add:

```bash
vercel secrets rm api_url
vercel secrets add api_url "https://new-api.grandarchivemeta.com/api"
```

### Remove Secret

```bash
vercel secrets rm <secret-name>

# Example
vercel secrets rm api_url
```

### List All Secrets

```bash
vercel secrets ls
```

### Rename Secret

```bash
vercel secrets rename <old-name> <new-name>

# Example
vercel secrets rename api_url api_endpoint
```

## Using Secrets in vercel.json

### Current Usage

```json
{
  "env": {
    "NEXT_PUBLIC_API_URL": "@api_url",
    "NEXT_PUBLIC_SITE_URL": "@site_url"
  }
}
```

### Adding More Secrets

```json
{
  "env": {
    "NEXT_PUBLIC_API_URL": "@api_url",
    "NEXT_PUBLIC_SITE_URL": "@site_url",
    "NEXT_PUBLIC_GA_ID": "@ga_tracking_id",
    "API_SECRET_KEY": "@api_secret"
  }
}
```

## Best Practices

### ✅ DO

- Use secrets for values shared across multiple projects
- Use descriptive secret names (e.g., `api_url` not `url`)
- Document all secrets in this file
- Use lowercase with underscores for secret names
- Keep secret values secure and don't share them

### ❌ DON'T

- Store secrets in Git
- Use secrets for project-specific values (use env vars instead)
- Share secret values in plain text
- Use special characters in secret names
- Commit secret values to version control

## Secrets vs Environment Variables

| Feature | Secrets | Environment Variables |
|---------|---------|----------------------|
| **Scope** | Account-wide | Project-specific |
| **Setup** | CLI required | Dashboard or CLI |
| **Reference** | `@secret_name` | Direct value |
| **Best For** | Shared values | Project-specific values |
| **Encryption** | Encrypted at rest | Encrypted at rest |
| **Recommended** | No | Yes |

## Recommendation for This Project

**Use Environment Variables Instead of Secrets**

For this project, it's simpler to use environment variables directly:

1. Remove the `@` references in `vercel.json` (optional)
2. Set environment variables in Vercel dashboard
3. Deploy

### Modified vercel.json (Without Secrets)

```json
{
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "nextjs",
  "regions": ["iad1"]
}
```

Then set environment variables directly in the dashboard:
- `NEXT_PUBLIC_API_URL` = `https://api.grandarchivemeta.com/api`
- `NEXT_PUBLIC_SITE_URL` = `https://grandarchivemeta.com`

## Troubleshooting

### Secret Not Found

**Error**: `Error: Secret "@api_url" not found`

**Solutions**:
1. Check secret exists: `vercel secrets ls`
2. Verify secret name spelling in `vercel.json`
3. Ensure you're logged in: `vercel whoami`
4. Create the secret: `vercel secrets add api_url "value"`

### Secret Value Not Updating

**Issue**: Changed secret but old value still used

**Solutions**:
1. Redeploy without cache: `vercel --prod --force`
2. Wait a few minutes for propagation
3. Verify secret value: `vercel secrets ls` (shows name only, not value)

### Permission Issues

**Error**: `Error: You don't have permission to access this secret`

**Solutions**:
1. Check team membership if using teams
2. Verify you're on the correct account: `vercel switch`
3. Ensure you have admin access to the team/account

## Alternative: Using .env Files

For local development, you can create environment-specific files:

```bash
# Development
.env.local

# Production (example only, never commit)
.env.production.example
```

Vercel will automatically detect and use environment variables from the dashboard, regardless of secrets configuration.

## Security Notes

- Secrets are encrypted at rest in Vercel's infrastructure
- Secrets are only decrypted at build time and runtime
- Secret values are never exposed in logs or UI
- Only secret names are visible, not values
- Secrets are scoped to your account/team

## Migration Guide

### From Secrets to Environment Variables

1. **Note current secret values**:
   ```bash
   # You'll need to know the values
   # Secrets are encrypted, so retrieve from your secure storage
   ```

2. **Add as environment variables in Vercel dashboard**:
   - Go to Project → Settings → Environment Variables
   - Add each variable with its value
   - Select all environments (Production, Preview, Development)

3. **Update vercel.json** (optional):
   - Remove the `env` section, or
   - Keep it but remove the `@` prefix

4. **Redeploy**:
   ```bash
   vercel --prod
   ```

5. **Verify**:
   - Check application loads correctly
   - Verify environment variables in browser console
   - Test all functionality

6. **Clean up secrets** (optional):
   ```bash
   vercel secrets rm api_url
   vercel secrets rm site_url
   ```

## Quick Reference

```bash
# Create secret
vercel secrets add <name> "<value>"

# List secrets
vercel secrets ls

# Remove secret
vercel secrets rm <name>

# Rename secret
vercel secrets rename <old> <new>

# Deploy with secrets
vercel --prod
```

## Support

- **Vercel Secrets Docs**: https://vercel.com/docs/concepts/projects/environment-variables#secrets
- **Environment Variables**: https://vercel.com/docs/concepts/projects/environment-variables
- **Vercel CLI**: https://vercel.com/docs/cli

---

**Note**: For most projects, including this one, using environment variables directly in the Vercel dashboard is simpler and more maintainable than using secrets.
